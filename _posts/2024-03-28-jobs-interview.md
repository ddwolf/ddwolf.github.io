## 分布式系统的稳定性要求，几个9？
**先上一幅图，不同系统的可靠性要求**
![不同系统的可靠性要求](/img/2024-03-28-jobs-interview.ha-num-of-9-requirement.png)
**IT系统的稳定性**是一个关键指标，它影响着用户体验、业务连续性以及公司的声誉。在衡量IT系统稳定性时，业界通常采用两种方式：

1. **时间维度**：
    - 这种方法从故障的角度出发，评估系统的稳定性。
    - 可用性计算公式为：可用性 = 正常运行时间 / (正常运行时间 + 故障时间)。
    - 例如，如果系统请求成功率低于95%，并且持续超过10分钟，就会被视为故障，这段时间被纳入故障时间（Downtime）。
    - 通过这种方式，我们可以限制系统的“生病时间”，确保系统稳定性。

2. **请求维度**：
    - 这种方法从成功请求的角度出发，评估系统的稳定性。
    - 可用性计算公式为：可用性 = 成功请求次数 / 总请求次数。
    - 例如，一天内系统有100,000次请求，期望的成功率至少为95%。如果有5001次请求失败，即成功率低于95%，则系统被视为不正常。
    - 这种方式更严格，不会漏掉任何一次问题的影响。

**系统稳定性的衡量标准**取决于以下三个因素：
1. **成本因素**：更高的可用性通常需要更多的资源投入，但也伴随着更高的成本。企业需要根据ROI（回报率）来权衡。
2. **业务容忍度**：核心业务需要更高的可用性，而非核心业务可能容忍较低的可用性。
3. **系统当前状况**：结合实际情况，逐步提高稳定性标准。

总之，系统需要几个9的可用性取决于具体情况，但稳定性始终是技术的基本面，值得不遗余力地提升。¹²³⁴

源: 与必应的对话， 2024/3/29
(1) 高可用性系统建设|衡量系统稳定性的两种方式 - 知乎. https://zhuanlan.zhihu.com/p/625073281.
(2) 高可用性系统建设|衡量系统稳定性的两种方式 - 知乎. https://bing.com/search?q=%e5%a6%82%e4%bd%95%e8%ae%a1%e7%ae%97IT%e7%b3%bb%e7%bb%9f%e7%a8%b3%e5%ae%9a%e6%80%a7.
(3) 系统稳定性架构 - 知乎 - 知乎专栏. https://zhuanlan.zhihu.com/p/611375139.
(4) 衡量技术的最关键指标，稳定性 - 知乎 - 知乎专栏. https://zhuanlan.zhihu.com/p/149378669.

分布式存储系统的稳定性要求通常以“几个9”来衡量，表示系统在一定时间内的可用性。这个指标对于不同的业务和应用场景可能有不同的要求。以下是一些常见的分布式存储系统的可用性要求：

1. **三个9（99.9%）**：
    - 这意味着系统每年最多允许**8.76小时**的不可用时间。
    - 适用于一些非关键业务或低成本应用。

2. **四个9（99.99%）**：
    - 这意味着系统每年最多允许**52.56分钟**的不可用时间。
    - 适用于大多数业务应用，但不包括关键业务。

3. **五个9（99.999%）**：
    - 这意味着系统每年最多允许**5.26分钟**的不可用时间。
    - 适用于关键业务、金融交易、医疗保健等高可靠性应用。

为了实现这些可用性要求，分布式存储系统通常采用多副本、数据冗余、故障切换等技术来提高系统的稳定性和可靠性¹²³⁴。

源: 与必应的对话， 2024/3/29
1. 分布式存储系统数据可靠性技术 - 知乎 - 知乎专栏. https://zhuanlan.zhihu.com/p/624890449.
2. 分布式存储配置要求\_分布式存储的节点实际可得容量-CSDN博客. https://blog.csdn.net/huapeng\_guo/article/details/132169088.
3. 分布式存储的优势有哪些？ - 知乎 - 知乎专栏. https://zhuanlan.zhihu.com/p/128997085.
4. 运维分布式存储：提升数据安全性和可靠性的关键-PingCAP | 平凯星辰. https://cn.pingcap.com/article/post/9754.html.

## 分布式一致性协议的选主流程对对比优缺点。
 - `paxos` 以 nodeId 最大的节点为主
 - `raft` 选择具有最大 `commit index`，且 `term` 最大的 candidate 为主
 - `zookeeper` 选择具体最大 `round number` 且 `zkid` 权重最大的节点为主。这个选主方式相对 `raft` 能更快的选出主。因为同一轮投票中，每次比较两张选票的时候都具有倾向性，货币选择具有最大 `zxid` 的节点为主。
 - 问这个问题的时候考官想知道我是否了解业界最新的选主方案

## 代码编程题
 - 不使用锁，利用 `N` 个线程顺序打印 `1` ~ `M`

```cpp
constexpr int M = 7;
constexpr int N = 2;
atomic<unsigned int> curNum {std::numeric_limits<unsigned int>::max() - 9};
atomic<int> curNode{0};
void debug2(int a) {
  cout << a << ":" << (curNum % M) << endl << flush;
}

int main() {
    thread *threads[N];
    for (int i = 0; i < N; ++i) {
        threads[i] = new thread([i](){
            int index = i;
            while (true) {
                if (curNode % N == i) {
                    debug2(index);
                    curNum = (curNum + 1) % M;
                    curNode = (curNode + 1 ) % N;
                }
            }
        });
    }
    for (int i = 0; i < N; ++i) {
        threads[i]->join();
    }
}
```
 - 两个字符串分别用于基因描述，格式为 `xCxCxC` ...，`x` 代表后面的 `C` 出现的次数，`C` 代表 `ACTG` 四个字母中的一个。需要计算出这两个基因串中相同位置字母相同的比例。
    [gene.cpp](/codes/gene.cpp)